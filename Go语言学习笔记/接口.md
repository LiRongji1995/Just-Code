
# Goè¯­è¨€å­¦ä¹ ç¬”è®° - ç¬¬å…­ç«  æ¥å£ï¼ˆå®Œå…¨ç‰ˆï¼‰

---

## âœ… 6.1 æ¥å£çš„åŸºæœ¬å®šä¹‰

æ¥å£ï¼ˆinterfaceï¼‰æ˜¯ Go çš„æ ¸å¿ƒæŠ½è±¡æœºåˆ¶ã€‚å®ƒæè¿°ä¸€ç»„æ–¹æ³•ç­¾åï¼Œåªè¦ä¸€ä¸ªç±»å‹å®ç°äº†è¿™äº›æ–¹æ³•ï¼Œå°±å®ç°äº†è¿™ä¸ªæ¥å£ã€‚

```go
type Stringer interface {
    String() string
}
```

Go ä¸­çš„æ¥å£æ˜¯**éšå¼å®ç°**çš„ï¼Œä¸éœ€è¦ `implements` å…³é”®å­—ã€‚

---

## âœ… 6.2 æ¥å£çš„åº•å±‚æœºåˆ¶

æ¥å£å˜é‡åº•å±‚ç»“æ„ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

```go
type iface struct {
    tab  *itab  // ç±»å‹ä¿¡æ¯ + æ–¹æ³•è¡¨
    data *T     // å®é™…æ•°æ®æŒ‡é’ˆ
}
```

è¿™æ„å‘³ç€æ¥å£å˜é‡èµ‹å€¼å…¶å®æ˜¯å¤åˆ¶æ•°æ®å’Œç±»å‹ä¿¡æ¯ã€‚

---

## âœ… 6.3 ç©ºæ¥å£ interface{}

ç©ºæ¥å£ `interface{}` æ²¡æœ‰å®šä¹‰ä»»ä½•æ–¹æ³•ï¼Œå› æ­¤æ‰€æœ‰ç±»å‹éƒ½å®ç°äº†å®ƒã€‚å¸¸ç”¨äºï¼š

- é€šç”¨å‚æ•°ä¼ é€’ï¼›
- åŠ¨æ€ç±»å‹å¤„ç†ï¼›
- `map[string]interface{}` è¡¨ç¤ºä»»æ„ç»“æ„ã€‚

---

## âœ… 6.4 ç±»å‹æ–­è¨€ä¸ type switch

```go
var i interface{} = "hello"

s := i.(string)        // æ–­è¨€æˆåŠŸ
s, ok := i.(string)    // å®‰å…¨æ–­è¨€

switch v := i.(type) {
case string:
    fmt.Println("string:", v)
case int:
    fmt.Println("int:", v)
}
```

---

## âœ… 6.5 æ¥å£ä¸æ–¹æ³•é›†åŒ¹é…è§„åˆ™

| ç±»å‹         | æ–¹æ³•é›†åŒ…å«                    |
|--------------|-------------------------------|
| `T`ï¼ˆå€¼ç±»å‹ï¼‰ | æ‰€æœ‰ `func (t T)` æ–¹æ³•         |
| `*T`ï¼ˆæŒ‡é’ˆï¼‰  | æ‰€æœ‰ `func (t T)` + `func (t *T)` æ–¹æ³• |

ç±»å‹èƒ½å¦èµ‹å€¼ç»™æ¥å£ï¼Œå–å†³äºæ–¹æ³•é›†æ˜¯å¦æ»¡è¶³æ¥å£å®šä¹‰çš„æ–¹æ³•ã€‚

---

## âœ… 6.6 æ¥å£ä¸º nil çš„é™·é˜±

```go
var a interface{} = nil                      // true
var b interface{} = (*int)(nil)              // false: b != nil
```

åªæœ‰ tab å’Œ data éƒ½ä¸º nil æ—¶ï¼Œæ¥å£å˜é‡æ‰ç­‰äº nilã€‚

---

## âœ… 6.7 æ¥å£åµŒå…¥ä¸ç»„åˆ

æ¥å£å¯ä»¥åµŒå¥—ç»„åˆï¼Œæ„å»ºæ›´å¤æ‚çš„æ¥å£ï¼š

```go
type Reader interface {
    Read([]byte) (int, error)
}

type Writer interface {
    Write([]byte) (int, error)
}

type ReadWriter interface {
    Reader
    Writer
}
```

---

# ğŸ” æ¥å£çœŸæ­£çš„éš¾ç‚¹ï¼šä¸æ˜¯è¯­æ³•ï¼Œè€Œæ˜¯è®¾è®¡ä¸åº”ç”¨

---

## âœ… å®é™…å¼€å‘ä¸­çš„äº”å¤§æ¥å£åº”ç”¨åœºæ™¯ï¼ˆæ¯ç±»å«æ·±å…¥ç¤ºä¾‹ï¼‰

---

### 1. å¯¹æ¥å‰ç«¯è¯·æ±‚ï¼šé¢å‘æ¥å£çš„ Service è§£è€¦

```go
// æ¥å£å®šä¹‰
type UserService interface {
    Register(name, password string) (int64, error)
}

// å®ç°
type DBUserService struct {
    db *sql.DB
}

func (s *DBUserService) Register(name, password string) (int64, error) {
    result, err := s.db.Exec("INSERT INTO users(name, password) VALUES (?, ?)", name, password)
    if err != nil {
        return 0, err
    }
    return result.LastInsertId()
}

// æ§åˆ¶å™¨ä¸­ä½¿ç”¨æ¥å£
func NewUserHandler(svc UserService) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        name := r.FormValue("name")
        pwd := r.FormValue("pwd")
        id, err := svc.Register(name, pwd)
        if err != nil {
            http.Error(w, "register failed", 500)
            return
        }
        fmt.Fprintf(w, "user created: %d", id)
    }
}
```

---

### 2. æµ‹è¯•æ³¨å…¥ï¼šæŠ½è±¡ä¾èµ–ä»¥æ”¯æŒ mock

```go
type Notifier interface {
    Send(msg string) error
}

// æ­£å¼å®ç°ï¼šå‘é‚®ä»¶
type EmailNotifier struct{}
func (e *EmailNotifier) Send(msg string) error {
    fmt.Println("Send email:", msg)
    return nil
}

// mock å®ç°ï¼šåªæ‰“å°
type FakeNotifier struct{}
func (f *FakeNotifier) Send(msg string) error {
    fmt.Println("Mock send:", msg)
    return nil
}

// è¢«æµ‹è¯•ä»£ç 
func Alert(n Notifier) {
    _ = n.Send("Server down")
}
```

---

### 3. æ’ä»¶æ¶æ„ï¼šä¸­é—´ä»¶æˆ–æ¨¡å—æ‰©å±•

```go
type Handler interface {
    Handle(req string) string
}

type Middleware interface {
    Wrap(next Handler) Handler
}

// æ—¥å¿—ä¸­é—´ä»¶
type LoggingMiddleware struct{}
func (m *LoggingMiddleware) Wrap(next Handler) Handler {
    return HandlerFunc(func(req string) string {
        fmt.Println("request:", req)
        return next.Handle(req)
    })
}

// å‡½æ•°é€‚é…å™¨
type HandlerFunc func(string) string
func (f HandlerFunc) Handle(req string) string {
    return f(req)
}

func main() {
    final := HandlerFunc(func(req string) string {
        return "Hello " + req
    })

    mw := &LoggingMiddleware{}
    wrapped := mw.Wrap(final)

    fmt.Println(wrapped.Handle("Tom"))
}
```

---

### 4. å¹¶å‘ä»»åŠ¡å»ºæ¨¡ï¼šJob æŠ½è±¡ + worker pool

```go
type Job interface {
    Run()
}

type PrintJob struct {
    ID int
}

func (p *PrintJob) Run() {
    fmt.Printf("job %d running\n", p.ID)
}

func worker(jobs <-chan Job, id int) {
    for job := range jobs {
        fmt.Printf("Worker %d got job\n", id)
        job.Run()
    }
}

func main() {
    jobQueue := make(chan Job, 10)
    for i := 0; i < 3; i++ {
        go worker(jobQueue, i)
    }

    for j := 0; j < 5; j++ {
        jobQueue <- &PrintJob{ID: j}
    }
    close(jobQueue)
    time.Sleep(1 * time.Second)
}
```

---

### 5. æ ‡å‡†åº“é€‚é…ï¼šè‡ªå®šä¹‰ç±»å‹å®ç° io.Reader

```go
type MyReader struct {
    content string
    offset  int
}

func (r *MyReader) Read(p []byte) (int, error) {
    if r.offset >= len(r.content) {
        return 0, io.EOF
    }
    n := copy(p, r.content[r.offset:])
    r.offset += n
    return n, nil
}

func main() {
    r := &MyReader{content: "hello, Go"}
    io.Copy(os.Stdout, r)
}
```

---

# âŒ æ¥å£è®¾è®¡å¸¸è§åä¾‹ä¸ âœ… æ”¹è¿›æ–¹æ¡ˆ

---

## âŒ æ¥å£å¤ªå¤§ã€æ–¹æ³•å¤ªå¤š

```go
type UserService interface {
    Register()
    Login()
    Logout()
    Delete()
    Update()
    Suspend()
}
```

âœ… æ‹†åˆ†å°æ¥å£ï¼š

```go
type Registrar interface {
    Register()
}

type Authenticator interface {
    Login()
    Logout()
}

type Updater interface {
    Update()
}
```

---

## âŒ æ²¡æœ‰å¤šå®ç°å´å¼ºè¡ŒæŠ½è±¡

```go
type EmailService interface {
    Send(to, subject, body string) error
}
```

âœ… å…ˆä½¿ç”¨ structï¼Œæœªæ¥éœ€è¦å†æŠ½è±¡æˆæ¥å£ã€‚

```go
type EmailSender struct{}
func (e *EmailSender) Send(...) error { ... }
```



---

## âŒ æ»¥ç”¨ interface{}

```go
func Log(data interface{}) {
    fmt.Printf("%v\n", data)
}		
```

âœ… ä½¿ç”¨å…·ä½“ç±»å‹æˆ–æ³›å‹ä»£æ›¿ç©ºæ¥å£ã€‚

```go
func Log[T any](data T) {
    fmt.Printf("%v\n", data)
}
```

æˆ–

```go
type Stringer interface {
    String() string
}
```



---

## âŒ å€¼æ¥æ”¶è€…å¯¼è‡´æ— æ³•åŒ¹é…æ¥å£

```go
type Worker interface {
    Work()
}

type Developer struct{}
func (d *Developer) Work() {} // æŒ‡é’ˆæ¥æ”¶è€…

var d Developer
var _ Worker = d // âŒ ç¼–è¯‘å¤±è´¥ï¼šDeveloper ä¸åŒ¹é… Worker
```

âœ… ä¼ æŒ‡é’ˆ & ç”¨æŒ‡é’ˆæ¥æ”¶è€…ç»Ÿä¸€é£æ ¼ã€‚

```go
var _ Worker = &d // âœ… OK
```

---

## âŒ æ¥å£å‘½åæ— è¯­ä¹‰

```go
type Doer interface {
    Do()
}
```

âœ… ä½¿ç”¨èŒè´£å¯¼å‘å‘½åï¼Œå¦‚ EmailSenderã€DataFetcher ç­‰ã€‚

```go
type EmailSender interface {
    Send(to, subject, body string) error
}
```



---

# ğŸ§  æ¥å£è®¾è®¡äº”å¤§å»ºè®®

| åŸåˆ™                   | è¯´æ˜ |
|------------------------|------|
| Small Interface        | æ¯ä¸ªæ¥å£åªå®šä¹‰æœ€å°æ–¹æ³•é›† |
| No Premature Abstraction | æ²¡æœ‰å¤šå®ç°ï¼Œå°±ä¸è¦å®šä¹‰æ¥å£ |
| Avoid interface{}      | ä½¿ç”¨å…·ä½“ç±»å‹æˆ–æ³›å‹æ›´å®‰å…¨ |
| Use Pointer Receivers  | ä¸€è‡´æ€§ + é¿å…åŒ¹é…å¤±è´¥ |
| Semantic Naming        | æ¥å£åè¡¨è¾¾èŒè´£ï¼Œä¸ä½¿ç”¨ `Doer`, `Handler` ç­‰ç©ºæ³›è¯ |

---

# âœ… æ€»ç»“ï¼šæ¥å£æ˜¯ Go æŠ½è±¡çš„æ ¸å¿ƒ

- å­¦ä¼šå®šä¹‰å°è€Œä¸“çš„æ¥å£ï¼›
- å–„ç”¨æ¥å£å®ç°è§£è€¦å’Œ mockï¼›
- ç†è§£æ–¹æ³•é›†æ˜¯æ¥å£åŒ¹é…çš„æ ¹æœ¬ï¼›
- æ³¨æ„ nil æ¥å£çš„ç»†èŠ‚é™·é˜±ï¼›
- ç†è§£â€œç®€å•è¯­æ³•èƒŒåçš„è®¾è®¡å“²å­¦â€ã€‚


---

# âœ… Go æ¥å£â€œç®€å•â€çš„åœ°æ–¹

| ç‰¹æ€§               | å¯¹æ¯”å…¶ä»–è¯­è¨€     | è¯´æ˜                   |
|--------------------|------------------|------------------------|
| è¯­æ³•æç®€           | æ¯” Java/C++ ç®€å• | interface ä»…å®šä¹‰æ–¹æ³•é›† |
| æ— éœ€æ˜¾å¼ implements | åŒ¿åå®ç°è‡ªç„¶     | æ»¡è¶³æ–¹æ³•é›†å³å¯åŒ¹é…æ¥å£ |
| æ— ç»§æ‰¿ã€æ—  override/overload | ç®€åŒ–äº†ç±»å‹å±‚çº§å…³ç³» | æ— ç±»çš„å¤æ‚ç»“æ„        |
| åŠ¨æ€ç±»å‹å’Œå€¼åˆ†ç¦»   | ä¸éœ€ virtual table | åº•å±‚æ˜¯ tab + data ç»“æ„ |

ğŸ’¡ æ‰€ä»¥åˆå­¦è€…å­¦ Go æ¥å£å¸¸è§‰å¾—ï¼šâ€œè¯¶ï¼Œæ¥å£æ²¡ä»€ä¹ˆéš¾çš„â€ã€‚

---

# âš ï¸ çœŸæ­£éš¾çš„æ˜¯â€œæ¥å£è®¾è®¡æ€æƒ³ + åœºæ™¯åº”ç”¨â€

| éš¾ç‚¹ç±»å‹                | ä¸¾ä¾‹è¯´æ˜ |
|-------------------------|----------|
| å€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€… | ç±»å‹æ˜¯å¦èƒ½åŒ¹é…æ¥å£ï¼Ÿ |
| æ–¹æ³•é›†å†³å®šæ¥å£åŒ¹é…      | æ–¹æ³•é›†åŒ¹é…æ˜¯æ¥å£çš„ç»†èŠ‚è§„åˆ™ |
| æ¥å£æ¸…æ™°æ‹†è§£çš„åˆ†å·¥      | interface æ˜¯å¦è®¾è®¡å°è€Œä¸“ï¼Ÿæ˜¯å¦å®šä¹‰è¿‡æ—©ï¼Ÿ |
| æµ‹è¯•å‹å¥½æ€§              | ä¸ºäº†æµ‹è¯•æ³¨å…¥ mock å®ç° |
| æ’ä»¶å¼è§£è€¦              | é€šè¿‡æ¥å£è§£è€¦æ¨¡å—/ç»„ä»¶ï¼Œè®¾è®¡æ’ä»¶ç³»ç»Ÿ |
| æ€§èƒ½è€ƒé‡               | æ˜¯å¦å›  interface è°ƒç”¨å¼€é”€å¼•å‘æ€§èƒ½ä¸‹é™ï¼Ÿ |

### â— ç‰¹åˆ«æ˜¯åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œæ¥å£è®¾è®¡ä¸å½“ä¼šå¯¼è‡´ï¼š

- æ–¹æ³•å¤ªå¤šï¼Œè¿å small interface åŸåˆ™ï¼›
- æ¥å£å®šä¹‰è¿‡æ—©ï¼Œæœªæ¥æ¼”åŒ–å›°éš¾ï¼›
- æŒ‡é’ˆ/å€¼ä¸ä¸€è‡´ï¼Œèµ‹å€¼å¤±è´¥éš¾æ’æŸ¥ï¼›
- æ»¥ç”¨ interface{}ï¼Œä¸§å¤±ç±»å‹å®‰å…¨ï¼›
- ç¼–è¯‘é€šè¿‡ä½†è¡Œä¸ºå¼‚å¸¸ï¼Œè°ƒè¯•å›°éš¾ã€‚

---

## âœ… å°ç»“ä¸€å¥è¯ï¼š

> ğŸ“Œ Go çš„æ¥å£è¯­æ³•ç®€å•ï¼Œæ€æƒ³ææ·±ï¼Œè®¾è®¡å½±å“å…¨å±€æ¶æ„ã€‚

å¦‚æœä½ æŠŠæ¥å£åªæ˜¯â€œç”¨â€ï¼Œé‚£ç¡®å®å®ƒå¾ˆç®€å•ï¼›  
ä½†å¦‚æœä½ æƒ³â€œç”¨å¾—å¥½â€ï¼Œé‚£å®ƒæ¶‰åŠè®¾è®¡åŸåˆ™ã€æµ‹è¯•ç­–ç•¥ã€æ¶æ„è§£è€¦ã€æ€§èƒ½ä¼˜åŒ–ç­‰ä¸€æ•´å¥—åŠŸå¤«ã€‚


---

# âœ… Go æ¥å£â€œç®€å•â€çš„åœ°æ–¹

| ç‰¹æ€§             | å¯¹æ¯”å…¶ä»–è¯­è¨€    | è¯´æ˜                           |
|------------------|-----------------|--------------------------------|
| è¯­æ³•æç®€         | æ¯” Java/C++ ç®€å• | `interface` åªå®šä¹‰æ–¹æ³•é›†       |
| æ— éœ€æ˜¾å¼ implements | åŒ¿åå®ç°æ›´è‡ªç„¶   | æ»¡è¶³æ–¹æ³•ç­¾åå³å¯åŒ¹é…æ¥å£       |
| æ— ç»§æ‰¿ã€æ—  overload | ç®€åŒ–äº†ç±»å‹å±‚çº§å…³ç³» | æ²¡æœ‰ç±»çš„å¤æ‚ç»“æ„               |
| åŠ¨æ€ç±»å‹å’Œå€¼åˆ†ç¦»   | ä¸éœ€è¦ virtual table | æ¥å£åº•å±‚ä¸º tab + data ç»“æ„ |

ğŸ’¡ æ‰€ä»¥åˆå­¦è€…å­¦ Go æ¥å£ä¼šè§‰å¾—ï¼šã€Œæ¥å£æ²¡ä»€ä¹ˆéš¾çš„ã€ã€‚

---

# âš ï¸ çœŸæ­£éš¾çš„åœ¨â€œæ¥å£è®¾è®¡æ€æƒ³ + åœºæ™¯åº”ç”¨â€

| éš¾ç‚¹ç±»å‹               | ä¸¾ä¾‹è¯´æ˜                   |
|------------------------|----------------------------|
| å€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€… | ç±»å‹æ˜¯å¦èƒ½åŒ¹é…æ¥å£ï¼Ÿ       |
| æ–¹æ³•é›†ä¸æ¥å£åŒ¹é…è§„åˆ™   | ç±»å‹æ»¡è¶³æ¥å£çš„ç»†èŠ‚è§„åˆ™     |
| æ¥å£æ¸…æ™°æ‹†è§£ä¸åˆ†å·¥     | interface æ˜¯å¦è¿‡å¤§æˆ–å‘½åå«ç³Š |
| æµ‹è¯•å‹å¥½æ€§             | æ˜¯å¦æ–¹ä¾¿ mock ä¸æ³¨å…¥       |
| æ’ä»¶å¼æ‰©å±•             | æ¥å£æ˜¯å¦é€‚åˆä½œä¸ºç³»ç»Ÿæ‰©å±•ç‚¹ |
| æ€§èƒ½è€ƒé‡               | interface è°ƒç”¨æ˜¯å¦ä¼šå½±å“æ€§èƒ½ |

ğŸ“Œ è‹¥æ¥å£è®¾è®¡ä¸å½“ï¼Œä¼šå‡ºç°ï¼š

- æ¥å£æ–¹æ³•è¿‡å¤šï¼ˆè¿èƒŒ Go çš„ small interface åŸåˆ™ï¼‰ï¼›
- æ¥å£å®šä¹‰è¿‡æ—©å¯¼è‡´æœªæ¥åƒµåŒ–ï¼›
- å€¼/æŒ‡é’ˆæ¥æ”¶è€…ä¸ä¸€è‡´ï¼Œå¯¼è‡´èµ‹å€¼å¤±è´¥ï¼›
- æ»¥ç”¨ interface{} å¤±å»ç±»å‹å®‰å…¨ã€‚

---

# âœ… å°ç»“ä¸€å¥è¯ï¼š

> **Go çš„æ¥å£è¯­æ³•ç®€å•ï¼Œæ€æƒ³ææ·±ï¼Œè®¾è®¡å½±å“å…¨å±€æ¶æ„ã€‚**

å¦‚æœä½ ç”¨æ¥å£åªæ˜¯â€œç”¨â€ï¼Œé‚£å®ƒç¡®å®å¾ˆç®€å•ï¼›ä½†å¦‚æœä½ è¦â€œç”¨å¾—å¥½â€ï¼Œé‚£å®ƒå°±æ¶‰åŠè®¾è®¡æ¨¡å¼ã€æµ‹è¯•ç­–ç•¥ã€æ¨¡å—è§£è€¦ã€æ€§èƒ½ä¼˜åŒ–ç­‰ä¸€æ•´å¥—åŠŸå¤«ã€‚

