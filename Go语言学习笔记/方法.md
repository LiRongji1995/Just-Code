
# Go语言学习笔记 - 第五章 方法（详实版）

---

## ✅ 5.1 方法定义

### 概念：
方法是绑定到特定类型的函数，其语法在 func 后增加“接收者”参数：

```go
type Person struct {
    Name string
}

func (p Person) SayHello() {
    fmt.Println("Hello, my name is", p.Name)
}
```

---

### 值接收者 vs 指针接收者

```go
func (p Person) SetNameValue(name string) {
    p.Name = name
}

func (p *Person) SetNamePtr(name string) {
    p.Name = name
}
```

#### 对比说明：

| 接收者类型 | 是否修改原始数据 | 是否拷贝接收者 | 用途 |
|------------|------------------|----------------|------|
| 值接收者   | 否（传值）        | 是              | 只读、复制安全 |
| 指针接收者 | 是（传址）        | 否              | 修改字段、节省资源 |

#### 示例：

```go
p := Person{Name: "Alice"}
p.SetNameValue("Tom")
fmt.Println(p.Name) // "Alice"

p.SetNamePtr("Tom")
fmt.Println(p.Name) // "Tom"
```

---

## ✅ 5.2 匿名字段与方法提升（模拟继承）

```go
type Human struct{}
func (h Human) Walk() { fmt.Println("walking") }

type Student struct {
    Human
}

s := Student{}
s.Walk() // 自动提升，Student拥有 Walk 方法
```

---

## ✅ 5.3 方法集（method set）

### 方法集规则：

| 类型             | 方法集包含                     |
|------------------|--------------------------------|
| `T`（值类型）     | 所有 `func (t T)` 方法          |
| `*T`（指针类型）  | 所有 `func (t T)` 和 `func (t *T)` 方法 |

```go
type T struct{}
func (t T) A()    {}
func (t *T) B()   {}

var t T
t.A() // ✅
t.B() // ❌

var pt *T
pt.A() // ✅
pt.B() // ✅
```

---

## ✅ 5.4 方法表达式与方法值

### 方法表达式：

```go
type T struct{}
func (t T) Hello() { fmt.Println("hi") }

f := T.Hello
f(T{})  // 显式传接收者
```

### 方法值：

```go
t := T{}
f := t.Hello
f()     // 已绑定接收者
```

---

## ⚠️ 常见陷阱

- 方法不能重载（不支持同名不同参）；
- 指针方法不能由值类型调用，除非编译器自动转换；
- 方法不支持多态（值接收者不修改自身）；
- 接口匹配取决于方法集。

---

## ✅ 小结

| 特性               | 值接收者 | 指针接收者 |
|--------------------|----------|------------|
| 修改接收者         | ❌        | ✅          |
| 自动解引用         | ❌        | ✅          |
| 接口实现影响       | ✅        | ✅（更全面） |
| 推荐使用场景       | 小对象/只读 | 大对象/可变 |

---

